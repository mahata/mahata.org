machine:
  environment:
    BLOG_DIR: $HOME/$CIRCLE_PROJECT_REPONAME/blog
    PATH: ~/.local/bin:$PATH

dependencies:
  cache_directories:
    - ~/.local  # Not in use at this moment

test:
  override:
    - cd $BLOG_DIR; docker build -t blog.mahata.org .

deployment:
  deploy:
    branch: master
    commands:
      - export TODAY=$(date "+%Y%m%d")
      - cd $BLOG_DIR; docker tag blog.mahata.org mahata/blog.mahata.org:$(echo $TODAY)
      - cd $BLOG_DIR; docker login -u mahata -p $DOCKERHUB_PASS
      - cd $BLOG_DIR; docker push mahata/blog.mahata.org:$(echo $TODAY)
